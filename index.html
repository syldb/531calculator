<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>531 Calculator by @syldb</title>
    <script src="helpers.js"></script>
  </head>
  <body>
    <h1>531 calculator</h1>
    <h2>Simple strengh assistance template</h2>

    <h3>Choose your week</h3>
    <select id="week-select">
      <option value="1">Week 1: 5/5/5</option>
      <option value="2">Week 2: 3/3/3</option>
      <option value="3">Week 3: 5/3/1</option>
      <option value="4">Week 4: Deload</option>
    </select>

    <h3>Insert your TM here</h3>
    <form onsubmit="onSubmit(); return false;">
      OHP:<br>
      <input type="float" name="ohp"><br>
      Close grip bench:<br>
      <input type="float" name="cg-bench"><br>
      Deadlift:<br>
      <input type="float" name="deadlift"><br>
      Front squat:<br>
      <input type="float" name="front-squat"><br>
      Bench:<br>
      <input type="float" name="bench"><br>
      Incline bench:<br>
      <input type="float" name="incline-bench"><br>
      Squat:<br>
      <input type="float" name="squat"><br>
      Stiff legs deadlift:<br>
      <input type="float" name="sl-deadlift"><br>

      <input type="submit" value="Submit"><br><br>
    </form>

    <h3>Your numbers for this week</h3>
    <p>
      OHP:<br>
      <span id="ohp">TBD</span>
    </p>
    <p>
      Close grip bench:<br>
      <span id="cg-bench">TBD</span>
    </p>
    <p>
      Deadlift:<br>
      <span id="deadlift">TBD</span>
    </p>
    <p>
      Front squat:<br>
      <span id="front-squat">TBD</span>
    </p>
    <p>
      Bench:<br>
      <span id="bench">TBD</span>
    </p>
    <p>
      Incline bench:<br>
      <span id="incline-bench">TBD</span>
    <p>
      Squat:<br>
      <span id="squat">TBD</span>
    </p>
    <p>
      Stiff legs deadlift:<br>
      <span id="sl-deadlift">TBD</span>
    </p>

    <script>

      function loadJSON(filePath, callback) {
        var xobj = new XMLHttpRequest();
        xobj.overrideMimeType("application/json");
        xobj.open('GET', 'trainingMax.json', true); // Replace 'my_data' with the path to your file
        xobj.onreadystatechange = function () {
          if (xobj.readyState == 4 && xobj.status == "200") {
            // Required use of an anonymous callback as .open will NOT return a value but simply returns undefined in asynchronous mode
            callback(xobj.responseText);
          }
        };
        xobj.send(null);
      }

      function initForm() {
        loadJSON('trainingMax.json', function(data) {
          var liftsData = JSON.parse(data);
          for (var lift in liftsData) {
            var inputElement = document.querySelector("form input[name=" + lift + "]");
            inputElement.value = liftsData[lift];
          }
        });
      }

      function onSubmit() {
        var inputElements = document.querySelectorAll("form input[type='float']");
        inputElements.forEach(function(inputElement) {
          // Get the TM for this exercice
          var name = inputElement.getAttribute("name");
          var trainingMax = inputElement.value;

          // Avort if input is empty for this exercice
          if (trainingMax === "") {
            return;
          }
          // Compute the three values
          var isMainLift = isMainLiftReference[name];
          var weekNumber = document.getElementById("week-select").value;
          resultValues = "";
          for (var i=0; i<3; i++) {
            resultValues  = resultValues + computeValue(trainingMax, weekNumber, i, isMainLift);
            if (i<2) {
              resultValues = resultValues + " / ";
            }
          }

          // Write values in the result
          var resultElement = document.querySelector("span#" + name);
          resultElement.innerHTML = resultValues;
        });
      }

      var referenceTableMainLifts = [
        [65, 75, 85],
        [70, 80, 90],
        [75, 85, 95],
        [40, 50, 60]
      ];
      var referenceTableAssitanceLifts = [
        [50, 60, 70],
        [60, 70, 80],
        [65, 75, 85],
        [40, 50, 60]
      ];
      var isMainLiftReference = {
        "ohp": true,
        "cg-bench": false,
        "deadlift": true,
        "front-squat": false,
        "bench": true,
        "incline-bench": false,
        "squat": true,
        "sl-deadlift": false
      }

      function computeValue(trainingMax, weekNumber, setNumber, isMainLift) {
        if (isMainLift) {
          var referenceTable = referenceTableMainLifts;
        }
        else {
          var referenceTable = referenceTableAssitanceLifts;
        }
        var percentage = referenceTable[weekNumber-1][setNumber];
        var value = parseFloat(trainingMax) * percentage / 100;
        return roundTo2point5(value);
      }

      initForm()
    </script>
  </body>
</html>
